"use strict";angular.module("chowSauceApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/map",{templateUrl:"views/map.html",controller:"MapCtrl",controllerAs:"map"}).otherwise({redirectTo:"/"})}]),angular.module("chowSauceApp").controller("MainCtrl",["$scope",function(a){var b=["Welcome to ChowSauce!","ChowSauce!","Chow... Sauce!!!","CS Rocks!! :)","Chow... what!!?!?!","ChowSizzle in the hizzle!!!"],c=["The best way to find food, ever!","'A total game changer'","Capital One rocks!","What kind of food would you like to eat?"];a.subheader=b[Math.floor(Math.random()*b.length)],a.header=c[Math.floor(Math.random()*c.length)],a.foods=[{name:"pizza",emoji:"üçï",redirect:"/#!/map?type=pizza"},{name:"burger",emoji:"üçî",redirect:"/#!/map?type=burger"},{name:"taco",emoji:"üåÆ",redirect:"/#!/map?type=taco"},{name:"burrito",emoji:"üåØ",redirect:"/#!/map?type=burrito"},{name:"sushi",emoji:"üç£",redirect:"/#!/map?type=sushi"},{name:"icecream",emoji:"üç¶",redirect:"/#!/map?type=icecream"},{name:"donut",emoji:"üç©",redirect:"/#!/map?type=donut"},{name:"bar",emoji:"üç∏",redirect:"/#!/map?type=bar"},{name:"indian",emoji:"üçõ",redirect:"/#!/map?type=indian"},{name:"noodles",emoji:"üçú",redirect:"/#!/map?type=noodles"},{name:"coffee",emoji:"‚òïÔ∏è",redirect:"/#!/map?type=coffee"}]}]),angular.module("chowSauceApp").controller("MapCtrl",["$scope",function(a){function b(){$.ajax({type:"POST",success:function(a){var b=a.error;b?(console.error("IP Lookup failed"),j(b),$("#error-msg").text("IP Lookup failed")):(console.log("lat long recieved from server"),o=a.lat,n=a["long"],c())},error:function(a){console.log("Failure"),console.log(a)},url:v+"IP"})}function c(){var a=(new Date).getTime();console.log("lat: "+o),console.log("long: "+n),$.ajax({type:"POST",data:{food_type:k("type",window.location.href),geolocation:!1,"long":n,lat:o,radius:1e3,limit:30},success:function(b){var c=(new Date).getTime()-a;console.log("Yelp Request time: "+c),d(b)},error:function(a){console.log("Failure"),console.log(a)},url:v+"yelp"});var b=(new Date).getTime();mapboxgl.accessToken="pk.eyJ1IjoiamVyZW15c21vcmdhbiIsImEiOiJjaWxjemtvYWEzejR4dHlseGlkaGZmb2t5In0.BOYaLR5RW0tbUPTFuz5Y0g",q=new mapboxgl.Map({container:"map",style:"mapbox://styles/jeremysmorgan/cixxc3h1i00232rqjeeagcb2l",center:[n,o],zoom:13}),q.on("load",function(a){var c=(new Date).getTime()-b;console.log("map_load_time: "+c),e(a)})}function d(a){m=!0,p=a,console.log(a),l?(console.log("yelp called back seconde, map load. Entering main()"),f()):console.log("yelp called back first, map not loaded")}function e(a){l=!0,m?(console.log("map called back second, entering main"),f()):console.log("map called back first, yelp not loaded")}function f(){j("loaded");var a=p;if(console.log("data: "),console.log(a),0===a.length)g();else{for(var b=document.getElementById("listings"),c=0;c<a.length;c+=1){var d=b.appendChild(document.createElement("a"));d.href="javascript:;",d.className="title",d.dataPosition=c,d.innerHTML="";var e=a[c].name,f=d.appendChild(document.createElement("div"));f.className="item",f.id="listing-"+c;var k=f.appendChild(document.createElement("div"));k.innerHTML="<h4>"+e+"</h4>";var l=f.appendChild(document.createElement("div"));l.innerHTML+="Rating: ";for(var m=0;m<Math.round(a[c].rating);m++)l.innerHTML+="‚≠êÔ∏è";l.innerHTML="<h6>"+l.innerHTML+"</h6>",d.addEventListener("click",function(b){var c=a[this.dataPosition];h(c,!0),i(c,!0);var d=document.getElementsByClassName("active");d[0]&&d[0].classList.remove("active"),this.parentNode.classList.add("active")})}for(var n=[],c=0;c<a.length;c+=1){var o=a[c].location.display_address[0]+", "+a[c].location.display_address[1],r=a[c];n.push({type:"Feature",geometry:{type:"Point",coordinates:[r.coordinates.longitude,r.coordinates.latitude]},properties:{title:r.name,"icon-image":"restaurant-15",address:o}})}q.addLayer({id:"locations",type:"symbol",source:{type:"geojson",data:{type:"FeatureCollection",features:n}},layout:{"icon-image":"{icon}-15","text-field":"{title}","text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,.6],"text-anchor":"top"}}),q.on("click",function(a){console.log("map clicked");var b=q.queryRenderedFeatures(a.point,{layers:["locations"]});if(b.length){var c=b[0];h(c,!1),i(c,!1);var d=document.getElementsByClassName("active");d[0]&&d[0].classList.remove("active");c.properties.address}})}}function g(){console.log("Zero Results!"),j("zero-results")}function h(a,b){b?q.flyTo({center:[a.coordinates.longitude,a.coordinates.latitude],zoom:15.5}):q.flyTo({center:a.geometry.coordinates,zoom:15.5})}function i(a,b){if(b){console.log("in create pop up"),console.log(a);var c=document.getElementsByClassName("mapboxgl-popup");c[0]&&c[0].remove();new mapboxgl.Popup({closeOnClick:!0}).setLngLat([a.coordinates.longitude,a.coordinates.latitude]).setHTML("<h3>"+a.name+"</h3><a href='https://www.google.com/maps/place/"+a.location.display_address[0]+", "+a.location.display_address[1]+"'><h4>"+a.location.display_address[0]+", "+a.location.display_address[1]+"</h4></a>").addTo(q)}else{console.log(a);var c=document.getElementsByClassName("mapboxgl-popup");c[0]&&c[0].remove(),console.log(a.properties.address);new mapboxgl.Popup({closeOnClick:!0}).setLngLat(a.geometry.coordinates).setHTML("<h3>"+a.properties.title+"</h3><a href='https://www.google.com/maps/place/"+a.properties.address+"'><h4>"+a.properties.address+"</h4></a>").addTo(q)}}function j(a){for(var b=document.getElementsByClassName("map-div"),c=0;c<b.length;c++)$(b[c]).hide();$("#"+a).show()}function k(a,b){b||(b=window.location.href),a=a.replace(/[\[\]]/g,"\\$&");var c=new RegExp("[?&]"+a+"(=([^&#]*)|&|#|$)"),d=c.exec(b);return d?d[2]?decodeURIComponent(d[2].replace(/\+/g," ")):"":null}var l=!1,m=!1,n=null,o=null,p={},q=null,r=location.href.split("/"),s=r[0],t=r[2],u=s+"//"+t,v=u+"/";navigator.geolocation?(console.log("geolocation supported by browser found"),console.log(navigator.geolocation),navigator.geolocation.getCurrentPosition(function(a){o=a.coords.latitude,n=a.coords.longitude,console.log("In setIP"),console.log(o),console.log(n),c()},function(){console.log("location denied."),b()})):(console.log("Geolocation is not supported by this browser."),b())}]),angular.module("chowSauceApp").run(["$templateCache",function(a){a.put("views/main.html",'<body ng-controller="MainCtrl"> <div class="container-fluid"> <h1 class="text-center" id="title">ChowSauce</h1> <style media="screen">#title {\n        font-family: \'Raleway\', sans-serif;\n        font-size: 60px;\n        font-weight: 800;\n        line-height: 72px;\n        margin: 0 0 10px;\n        text-align: center;\n        transition: all .2s ease-in-out;\n        text-shadow: 2px 2px #00e7ff;\n      }\n\n      #title:hover {\n        transform: scale(1.05);\n      }</style> <h3 class="text-center" ng-bind="subheader"></h3> <div class="row"> <div ng-repeat="food in foods" class="col-xs-6 col-md-3"> <a href="{{food.redirect}}" class="thumbnail text-center"> <span class="emoji-holder text-center">{{food.emoji}}</span> </a> </div> </div> </div> <style media="screen">.emoji-holder {\n      font-size: 6em;\n    }\n\n    body div .jumbotron {\n      background-color: red;\n      border-radius: .25em;\n      width: 15em;\n    }</style> </body>'),a.put("views/map.html",'<body> <div class="container-fluid map-container"> <div class="text-center" id="loading" class="map-div"> <h3 class="centered text-centered">loading...</h3> <img class="image text-center centered" src="../images/loading.164d3e03.gif" alt=""> </div> <div id="loaded" class="map-div"> <div class="sidebar" id="sidebar"> <h1 id="forceblack">Locations</h1> <div id="listings" class="listings"></div> </div> </div> <div id="zero-results" class="map-div"> <div class="row"> <div class="col-md-4"> <h1>Zero results!</h1> <h6>Would you like to search again?</h6> <div class="form-group"> <label for="usr">Location:</label> <input id="pac-input" class="form-control controls" type="text" placeholder="Search Box" id="zero-results-location"> </div> </div> </div> </div> <div id="error" class="map-div"> <h1>Error!</h1> <h3 id="error-msg"></h3> </div> <div id="map" class="map"></div> </div> <style media="screen">/* ------------------------ // Map Directive CSS // ----------------------- */\n    /* Marker tweaks */\n\n    .mapboxgl-popup-close-button {\n      display: none;\n    }\n\n    .mapboxgl-popup-content {\n'+"      font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;\n      padding: 0;\n      width: 180px;\n    }\n\n    .mapboxgl-popup-content-wrapper {\n      padding: 1%;\n    }\n\n    .mapboxgl-popup-content h3 {\n      background: #91c949;\n      color: #fff;\n      margin: 0;\n      display: block;\n      padding: 10px;\n      border-radius: 3px 3px 0 0;\n      font-weight: 700;\n      margin-top: -15px;\n    }\n\n    .mapboxgl-popup-content h4 {\n      margin: 0;\n      display: block;\n      padding: 10px;\n      font-weight: 400;\n    }\n\n    .mapboxgl-popup-content div {\n      padding: 10px;\n    }\n\n    .mapboxgl-container .leaflet-marker-icon {\n      cursor: pointer;\n    }\n\n    .mapboxgl-popup-anchor-top>.mapboxgl-popup-content {\n      margin-top: 15px;\n    }\n\n    .mapboxgl-popup-anchor-top>.mapboxgl-popup-tip {\n      border-bottom-color: #91c949;\n    }\n\n    body {\n      color: #404040;\n      font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;\n      margin: 0;\n      padding: 0;\n      -webkit-font-smoothing: antialiased;\n    }\n\n    * {\n      -webkit-box-sizing: border-box;\n      -moz-box-sizing: border-box;\n      box-sizing: border-box;\n    }\n\n    h1 {\n      font-size: 22px;\n      margin: 0;\n      font-weight: 400;\n      line-height: 20px;\n      padding: 20px 2px;\n    }\n\n    a {\n      color: #404040;\n      text-decoration: none;\n    }\n\n    a:hover {\n      color: #101010;\n    }\n\n    .sidebar {\n      position: absolute;\n      width: 33.3333%;\n      height: 100%;\n      top: 0;\n      left: 0;\n      overflow: hidden;\n      border-right: 1px solid rgba(0, 0, 0, 0.25);\n    }\n\n    .pad2 {\n      padding: 20px;\n    }\n\n    .map {\n      position: absolute;\n      left: 33.3333%;\n      width: 66.6666%;\n      top: 0;\n      bottom: 0;\n    }\n\n    .heading {\n      background: #fff;\n      border-bottom: 1px solid #eee;\n      height: 60px;\n      line-height: 60px;\n      padding: 0 10px;\n    }\n\n    .listings {\n      height: 100%;\n      overflow: auto;\n      padding-bottom: 60px;\n    }\n\n    .listings .item {\n      display: block;\n      border-bottom: 1px solid #eee;\n      padding: 10px;\n      text-decoration: none;\n    }\n\n    .listings .item:last-child {\n      border-bottom: none;\n    }\n\n    .listings .item .title {\n      display: block;\n      color: #00853e;\n      font-weight: 700;\n    }\n\n    .listings .item .title small {\n      font-weight: 400;\n    }\n\n    .listings .item.active .title,\n    .listings .item .title:hover {\n      color: #8cc63f;\n    }\n\n    .listings .item.active {\n      background-color: #f8f8f8;\n    }\n\n     ::-webkit-scrollbar {\n      width: 3px;\n      height: 3px;\n      border-left: 0;\n      background: rgba(0, 0, 0, 0.1);\n    }\n\n     ::-webkit-scrollbar-track {\n      background: none;\n    }\n\n     ::-webkit-scrollbar-thumb {\n      background: #00853e;\n      border-radius: 0;\n    }\n\n    .clearfix {\n      display: block;\n    }\n\n    .clearfix::after {\n      content: '.';\n      display: block;\n      height: 0;\n      clear: both;\n      visibility: hidden;\n    }\n    /* ------------------------ // End of Map CSS // ----------------------- */</style> </body>")}]);