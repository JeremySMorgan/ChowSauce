"use strict";angular.module("chowSauceApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]).config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/main.html",controller:"MainCtrl",controllerAs:"main"}).when("/map",{templateUrl:"views/map.html",controller:"MapCtrl",controllerAs:"map"}).otherwise({redirectTo:"/"})}]),angular.module("chowSauceApp").controller("MainCtrl",["$scope",function(a){a.header="Welcome!",a.subheader="What kind of food would you like to eat?",a.foods=[{name:"pizza",emoji:"üçï",redirect:"/#!/map?type=pizza"},{name:"burger",emoji:"üçî",redirect:"/#!/map?type=burger"},{name:"taco",emoji:"üåÆ",redirect:"/#!/map?type=taco"},{name:"burrito",emoji:"üåØ",redirect:"/#!/map?type=burrito"},{name:"sushi",emoji:"üç£",redirect:"/#!/map?type=sushi"},{name:"icecream",emoji:"üç¶",redirect:"/#!/map?type=icecream"},{name:"donut",emoji:"üç©",redirect:"/#!/map?type=donut"},{name:"bar",emoji:"üç∏",redirect:"/#!/map?type=bar"},{name:"indian",emoji:"üçõ",redirect:"/#!/map?type=indian"},{name:"noodles",emoji:"üçú",redirect:"/#!/map?type=noodles"},{name:"coffee",emoji:"‚òïÔ∏è",redirect:"/#!/map?type=coffee"}]}]),angular.module("chowSauceApp").controller("MapCtrl",["$scope",function(a){}]),angular.module("chowSauceApp").run(["$templateCache",function(a){a.put("views/main.html",'<body ng-controller="MainCtrl"> <div class="container-fluid"> <h1 class="text-center" ng-bind="header"></h1> <h3 class="text-center" ng-bind="subheader"></h3> <div class="row"> <div ng-repeat="food in foods" class="col-xs-6 col-md-3"> <a href="{{food.redirect}}" class="thumbnail text-center"> <span class="emoji-holder text-center">{{food.emoji}}</span> </a> </div> </div> </div> <style media="screen">.emoji-holder {\n      font-size: 6em;\n    }\n\n    body div .jumbotron {\n      background-color: red;\n      border-radius: .25em;\n      width: 15em;\n    }</style> </body>'),a.put("views/map.html",'<body> <div class="container-fluid map-container"> <div class="sidebar" id="sidebar"> <h1 id="forceblack">Restraunts</h1> <div id="listings" class="listings"></div> </div> <div id="map" class="map"></div> </div> <script type="text/javascript">var map_loaded = false;\n    var yelp_loaded = false;\n    var long = null; //-78.926931; //null;\n    var lat = null; // 36.004203; // null;\n    var yelp_data = {};\n    var map = null;\n\n\n\n    pathArray = location.href.split("/");\n    protocol = pathArray[0];\n    host = pathArray[2];\n    url = protocol + "//" + host;\n    POST_baseurl = url + "/";\n\n\n    // -------------------------- // IP Call // ------------------------- //\n    if (navigator.geolocation) {\n      console.log("geolocation supported by browser found");\n      console.log(navigator.geolocation);\n      navigator.geolocation.getCurrentPosition(function(position) {\n        lat = position.coords.latitude;\n        long = position.coords.longitude;\n        console.log("In setIP");\n        console.log(lat);\n        console.log(long);\n        APICalls();\n      }, function() {\n        console.log("location denied.");\n        IPAjax();\n      });\n    } else {\n      console.log("Geolocation is not supported by this browser.");\n      IPAjax();\n    }\n\n    function IPAjax() {\n      $.ajax({\n        type: "POST",\n        success: function(response) {\n          console.log("lat long recieved from server");\n          lat = response.lat;\n          long = response.long;\n          APICalls();\n        },\n        error: function(xhr) {\n          console.log("Failure");\n          console.log(xhr);\n        },\n        url: POST_baseurl + "IP"\n      });\n    }\n\n\n\n\n\n    function APICalls() {\n\n      // -------------------------- // Yelp API Call // ------------------------- //\n      var yelp_start_time = new Date().getTime();\n      console.log("lat: " + lat);\n      console.log("long: " + long);\n      $.ajax({\n        type: "POST",\n        data: {\n          "food_type": getParameterByName("type", window.location.href),\n          "geolocation": false,\n          "long": long,\n          "lat": lat,\n          "radius": 1000,\n          "limit": 30\n        },\n        success: function(response) {\n          var yelp_request_time = new Date().getTime() - yelp_start_time;\n          console.log("Yelp Request time: " + yelp_request_time);\n          YelpCallback(response);\n        },\n        error: function(xhr) {\n          console.log("Failure");\n          console.log(xhr);\n        },\n        url: POST_baseurl + "yelp"\n      });\n\n      // -------------------------- // MapBox API Call // ------------------------- //\n      var map_start_time = new Date().getTime();\n      mapboxgl.accessToken = "pk.eyJ1IjoiamVyZW15c21vcmdhbiIsImEiOiJjaWxjemtvYWEzejR4dHlseGlkaGZmb2t5In0.BOYaLR5RW0tbUPTFuz5Y0g";\n      map = new mapboxgl.Map({\n        container: "map",\n        style: "mapbox://styles/jeremysmorgan/cixxc3h1i00232rqjeeagcb2l",\n        center: [long, lat],\n        zoom: 13\n      });\n\n      map.on("load", function(e) {\n        var map_load_time = new Date().getTime() - map_start_time;\n        console.log("map_load_time: " + map_load_time);\n        MapCallback(e);\n      });\n    }\n\n\n    function YelpCallback(data) {\n      yelp_loaded = true;\n      yelp_data = data;\n      console.log(data);\n      if (map_loaded) {\n        console.log("yelp called back seconde, map load. Entering main()");\n        main();\n      } else {\n        console.log("yelp called back first, map not loaded");\n      }\n    }\n\n    function MapCallback(e) {\n      map_loaded = true;\n      if (yelp_loaded) {\n        console.log("map called back second, entering main");\n        main();\n      } else {\n        console.log("map called back first, yelp not loaded");\n      }\n    }\n\n\n\n    function main() {\n      var data = yelp_data;\n      var listings = document.getElementById("listings");\n      for (var i = 0; i < data.length; i += 1) {\n        var name = data[i].name;\n        var listing = listings.appendChild(document.createElement("div"));\n        listing.className = "item";\n        listing.id = "listing-" + i;\n        var details = listing.appendChild(document.createElement("div"));\n        details.innerHTML = name;\n        var image = listing.appendChild(document.createElement("div"));\n      }\n\n      var features = [];\n\n      for (var i = 0; i < data.length; i += 1) {\n        var current_listing = data[i];\n        features.push({\n          "type": "Feature",\n          "geometry": {\n            "type": "Point",\n            "coordinates": [current_listing.coordinates.longitude, current_listing.coordinates.latitude]\n          },\n          "properties": {\n            "title": current_listing.name,\n            "icon-image": "restaurant-15"\n          }\n        });\n      }\n\n      map.addLayer({\n        "id": "restraunts",\n        "type": "symbol",\n        "source": {\n          "type": "geojson",\n          "data": {\n            "type": "FeatureCollection",\n            "features": features\n          }\n        },\n        "layout": {\n          "icon-image": "{icon}-15",\n          "text-field": "{title}",\n          "text-font": ["Open Sans Semibold", "Arial Unicode MS Bold"],\n          "text-offset": [0, 0.6],\n          "text-anchor": "top"\n        }\n      });\n    }\n\n    /*\n        // Add an event listener for the links in the sidebar listing\n        link.addEventListener(\'click\', function(e) {\n          // Update the currentFeature to the store associated with the clicked link\n          var currentFeature = data.features[this.dataPosition];\n          // 1. Fly to the point associated with the clicked link\n          flyToStore(clickedListing);\n          // 2. Close all other popups and display popup for clicked store\n          createPopUp(clickedListing);\n          // 3. Highlight listing in sidebar (and remove highlight for all other listings)\n          var activeItem = document.getElementsByClassName(\'active\');\n          if (activeItem[0]) {\n            activeItem[0].classList.remove(\'active\');\n          }\n          this.parentNode.classList.add(\'active\');\n        });\n    */\n\n    function flyToStore(currentFeature) {\n      map.flyTo({\n        center: currentFeature.geometry.coordinates,\n        zoom: 15\n      });\n    }\n\n    function createPopUp(currentFeature) {\n      var popUps = document.getElementsByClassName(\'mapboxgl-popup\');\n      // Check if there is already a popup on the map and if so, remove it\n      if (popUps[0]) popUps[0].remove();\n\n      var popup = new mapboxgl.Popup({\n          closeOnClick: false\n        })\n        .setLngLat(currentFeature.geometry.coordinates)\n        .setHTML(\'<h3>Sweetgreen</h3>\' +\n          \'<h4>\' + currentFeature.properties.address + \'</h4>\')\n        .addTo(map);\n    }\n\n\n    // -------------------------- // Accessory Functions  // ------------------------- //\n    function getParameterByName(name, url) {\n      if (!url) {\n        url = window.location.href;\n      }\n      name = name.replace(/[\\[\\]]/g, "\\\\$&");\n      var regex = new RegExp("[?&]" + name + "(=([^&#]*)|&|#|$)"),\n        results = regex.exec(url);\n      if (!results) return null;\n      if (!results[2]) return "";\n      return decodeURIComponent(results[2].replace(/\\+/g, " "));\n    }</script> <style media="screen">/* ------------------------ // Map Directive CSS // ----------------------- */\n    /* Marker tweaks */\n\n    .mapboxgl-popup-close-button {\n      display: none;\n    }\n\n    .mapboxgl-popup-content {\n'+"      font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;\n      padding: 0;\n      width: 180px;\n    }\n\n    .mapboxgl-popup-content-wrapper {\n      padding: 1%;\n    }\n\n    .mapboxgl-popup-content h3 {\n      background: #91c949;\n      color: #fff;\n      margin: 0;\n      display: block;\n      padding: 10px;\n      border-radius: 3px 3px 0 0;\n      font-weight: 700;\n      margin-top: -15px;\n    }\n\n    .mapboxgl-popup-content h4 {\n      margin: 0;\n      display: block;\n      padding: 10px;\n      font-weight: 400;\n    }\n\n    .mapboxgl-popup-content div {\n      padding: 10px;\n    }\n\n    .mapboxgl-container .leaflet-marker-icon {\n      cursor: pointer;\n    }\n\n    .mapboxgl-popup-anchor-top>.mapboxgl-popup-content {\n      margin-top: 15px;\n    }\n\n    .mapboxgl-popup-anchor-top>.mapboxgl-popup-tip {\n      border-bottom-color: #91c949;\n    }\n\n    body {\n      color: #404040;\n      font: 400 15px/22px 'Source Sans Pro', 'Helvetica Neue', Sans-serif;\n      margin: 0;\n      padding: 0;\n      -webkit-font-smoothing: antialiased;\n    }\n\n    * {\n      -webkit-box-sizing: border-box;\n      -moz-box-sizing: border-box;\n      box-sizing: border-box;\n    }\n\n    h1 {\n      font-size: 22px;\n      margin: 0;\n      font-weight: 400;\n      line-height: 20px;\n      padding: 20px 2px;\n    }\n\n    a {\n      color: #404040;\n      text-decoration: none;\n    }\n\n    a:hover {\n      color: #101010;\n    }\n\n    .sidebar {\n      position: absolute;\n      width: 33.3333%;\n      height: 100%;\n      top: 0;\n      left: 0;\n      overflow: hidden;\n      border-right: 1px solid rgba(0, 0, 0, 0.25);\n    }\n\n    .pad2 {\n      padding: 20px;\n    }\n\n    .map {\n      position: absolute;\n      left: 33.3333%;\n      width: 66.6666%;\n      top: 0;\n      bottom: 0;\n    }\n\n    .heading {\n      background: #fff;\n      border-bottom: 1px solid #eee;\n      height: 60px;\n      line-height: 60px;\n      padding: 0 10px;\n    }\n\n    .listings {\n      height: 100%;\n      overflow: auto;\n      padding-bottom: 60px;\n    }\n\n    .listings .item {\n      display: block;\n      border-bottom: 1px solid #eee;\n      padding: 10px;\n      text-decoration: none;\n    }\n\n    .listings .item:last-child {\n      border-bottom: none;\n    }\n\n    .listings .item .title {\n      display: block;\n      color: #00853e;\n      font-weight: 700;\n    }\n\n    .listings .item .title small {\n      font-weight: 400;\n    }\n\n    .listings .item.active .title,\n    .listings .item .title:hover {\n      color: #8cc63f;\n    }\n\n    .listings .item.active {\n      background-color: #f8f8f8;\n    }\n\n     ::-webkit-scrollbar {\n      width: 3px;\n      height: 3px;\n      border-left: 0;\n      background: rgba(0, 0, 0, 0.1);\n    }\n\n     ::-webkit-scrollbar-track {\n      background: none;\n    }\n\n     ::-webkit-scrollbar-thumb {\n      background: #00853e;\n      border-radius: 0;\n    }\n\n    .clearfix {\n      display: block;\n    }\n\n    .clearfix::after {\n      content: '.';\n      display: block;\n      height: 0;\n      clear: both;\n      visibility: hidden;\n    }\n    /* ------------------------ // End of Map CSS // ----------------------- */</style> </body>")}]);